import{e as de,p as n,k as _,o as d,c as w,j as e,A as t,h as x,l as y,K as k,F as I,r as K,b as i,H as ie,a2 as pe,ay as c,D as me,t as ce}from"./index-2701bbc4.js";const fe=i("div",{style:{"margin-top":"10px","font-size":"12px",color:"#999"}}," 对于小数据集来说，相对较小的种群就可以覆盖解空间 ",-1),ve=i("div",{style:{"margin-top":"10px","font-size":"12px",color:"#999"}}," 设置一个稍高的迭代次数可以深化算法的探索与优化 ",-1),_e=i("div",{style:{"margin-top":"10px","font-size":"12px",color:"#999"}}," 简约系数用于避免过于复杂的解。考虑到数据规模较小，可以设置一个中等的值，如0.01到01，以鼓励算法寻找更简洁的解。 ",-1),ye=i("div",{style:{"margin-top":"10px","font-size":"12px",color:"#999"}}," 由于数据集规模较小，可以考虑使用较大的样本比例，甚至是100%，以充分利用所有可用数据。 ",-1),be=i("div",{style:{"margin-top":"10px","font-size":"12px",color:"#999"}}," 高交叉率有助于增加种群的多样性 ",-1),he=i("div",{style:{"margin-top":"10px","font-size":"12px",color:"#999"}}," 变异率可以设置得相对较高，以促进解空间的探索 ",-1),Ve=i("div",{style:{"margin-top":"10px","font-size":"12px",color:"#999"}}," 由于提升变异可以帮助简化解的结构，推荐的概率设置为0.05到0.1之间。 ",-1),xe=i("div",{style:{"margin-top":"10px","font-size":"12px",color:"#999"}}," 点变异直接修改程序树的细节，建议的概率也是0.05到0.1之间。 ",-1),ge=i("div",{class:"el-upload__tip",slot:"tip"},"支持上传 XLSX/XLS 文件",-1),Me=i("h3",null,"返回的结果：",-1),we=i("h3",null,"生成的特征：",-1),ke={key:0},Se={key:1},Ue=i("p",null,"暂无特征数据。",-1),Ce=[Ue],Ee=de({__name:"symbolic_regression",setup($e){const f=n(0),g=n("1"),V=n([]),v=n({}),S=n(!1),U=n(!1),Q="http://localhost:5000/upload",C=n(20),$=n(0),z=n(1),E=n(1),L=n("1"),N=n(.3),j=n(.2),O=n(.1),T=n(.15),P=n(.05),R=n(.1),D=n(.05),F=n(.1),B=n(1e-6),H=n(.099999),A=n(["add","sub","mul","div","sqrt","log","abs","neg","inv"]),G=n(""),W=o=>{const l=o.best_params;v.value={};for(const u in l)v.value[u]=l[u];v.value.best_score=o.best_score},Y=async()=>{try{const l=await(await fetch("http://localhost:5000/download_txt",{method:"GET"})).blob(),u=window.URL.createObjectURL(l),m=document.createElement("a");m.href=u,m.setAttribute("download","symbolic_transformer_formulas.txt"),document.body.appendChild(m),m.click(),c.success("txt downloaded successfully")}catch(o){console.error("Error:",o),c.error("Failed to download model txt")}},Z=async()=>{try{const l=await(await fetch("http://localhost:5000/download_txt_names",{method:"GET"})).blob(),u=window.URL.createObjectURL(l),m=document.createElement("a");m.href=u,m.setAttribute("download","symbolic_transformer_formulas_with_feature_names.txt"),document.body.appendChild(m),m.click(),c.success("txtNames downloaded successfully")}catch(o){console.error("Error:",o),c.error("Failed to download model txtNames")}},ee=async()=>{const o=new FormData;o.append("file",V.value[0]),o.append("best_params",JSON.stringify(v.value)),fetch("http://localhost:5000/get_gp_features",{method:"POST",body:o}).then(l=>{if(!l.ok)throw new Error("网络响应不正常");return l.json()})},le=()=>{if(parseInt(g.value)<=0){c.error("请输入大于0的整数");return}(async()=>{if(await me(),g.value.trim()===""){c.error("请输入搜索次数。");return}if(!/^\d+$/.test(g.value)){c.error("搜索次数必须为整数。");return}f.value++})()},J=()=>{V.value[0]==null,f.value--},te=o=>{if(o.name.split(".")[1]!=="xlsx")return c.error("请上传.xlsx文件"),!1},oe=(o,l,u)=>{V.value.push(l.raw),c({type:"success",message:"上传成功"})},ae=()=>{fetch("http://localhost:5000/generate_features",{method:"POST",body:JSON.stringify({best_params:v.value}),headers:{"Content-Type":"application/json"}}).then(o=>{if(!o.ok)throw new Error("网络响应不正常");return o.blob()}).then(o=>{const l=window.URL.createObjectURL(new Blob([o])),u=document.createElement("a");U.value=!0,u.href=l,u.setAttribute("download","features.csv"),document.body.appendChild(u),u.click(),u.parentNode.removeChild(u)}).catch(o=>{console.error("发生了与 fetch 操作相关的问题：",o)}).finally(()=>{U.value=!1})},ne=()=>{if(!V.value||V.value.length===0){c.error("请上传文件。");return}const o=new FormData;o.append("file",V.value[0]),o.append("n_searches",g.value),o.append("population_size",`${C.value},${$.value}`),o.append("generations",`${z.value},${E.value}`),o.append("maxSamples",L.value),o.append("pCrossover",`${N.value},${j.value}`),o.append("pSubtreeMutation",`${O.value},${T.value}`),o.append("pHoistMutation",`${P.value},${R.value}`),o.append("pPointMutation",`${D.value},${F.value}`),o.append("parsimonyCoefficient",`${B.value},${H.value}`),o.append("functionSet",A.value),S.value=!0,fetch("http://localhost:5000/file1",{method:"POST",body:o}).then(l=>{if(!l.ok)throw new Error("网络响应不正常");return l.json()}).then(l=>{W(l),ee(),f.value=2}).catch(l=>{console.error("发生了问题：",l)}).finally(()=>{S.value=!1})},ue=(o,l,u)=>{c.error("上传文件发生错误，请检查文件是否正确")};return(o,l)=>{const u=_("el-step"),m=_("el-steps"),r=_("el-input"),p=_("el-form-item"),s=_("el-col"),b=_("el-row"),h=_("el-button"),q=_("el-form"),X=_("el-card"),re=_("el-upload");return d(),w("div",null,[e(m,{active:f.value,"finish-status":"success","align-center":"",style:{"margin-bottom":"20px"}},{default:t(()=>[e(u,{title:"第一步"}),e(u,{title:"第二步"}),e(u,{title:"下载结果"})]),_:1},8,["active"]),f.value===0?(d(),x(X,{key:0},{default:t(()=>[e(q,{"label-width":"120px",model:v.value},{default:t(()=>[e(p,{label:"输入搜索次数",prop:"nSearches"},{default:t(()=>[e(r,{modelValue:g.value,"onUpdate:modelValue":l[0]||(l[0]=a=>g.value=a),modelModifiers:{trim:!0},placeholder:"输入搜索次数",type:"number",min:"0"},null,8,["modelValue"])]),_:1}),e(p,{label:"符号集",prop:"nSearches"},{default:t(()=>[e(r,{modelValue:A.value,"onUpdate:modelValue":l[1]||(l[1]=a=>A.value=a),modelModifiers:{trim:!0},placeholder:"输入搜索次数"},null,8,["modelValue"])]),_:1}),e(p,{label:"种群大小",prop:"populationSize"},{default:t(()=>[e(b,{gutter:20},{default:t(()=>[e(s,{span:12},{default:t(()=>[e(r,{modelValue:C.value,"onUpdate:modelValue":l[2]||(l[2]=a=>C.value=a),modelModifiers:{trim:!0},placeholder:"最小值",type:"number",min:"40"},null,8,["modelValue"])]),_:1}),e(s,{span:12},{default:t(()=>[e(r,{modelValue:$.value,"onUpdate:modelValue":l[3]||(l[3]=a=>$.value=a),modelModifiers:{trim:!0},placeholder:"宽度",type:"number",min:"40"},null,8,["modelValue"])]),_:1})]),_:1}),fe]),_:1}),e(p,{label:"迭代代数",prop:"generations"},{default:t(()=>[e(b,{gutter:20},{default:t(()=>[e(s,{span:12},{default:t(()=>[e(r,{modelValue:z.value,"onUpdate:modelValue":l[4]||(l[4]=a=>z.value=a),modelModifiers:{trim:!0},placeholder:"最小值",type:"number",min:"50"},null,8,["modelValue"])]),_:1}),e(s,{span:12},{default:t(()=>[e(r,{modelValue:E.value,"onUpdate:modelValue":l[5]||(l[5]=a=>E.value=a),modelModifiers:{trim:!0},placeholder:"宽度",type:"number",min:"50"},null,8,["modelValue"])]),_:1})]),_:1}),ve]),_:1}),e(p,{label:"简约系数",prop:"parsimonyCoefficient"},{default:t(()=>[e(b,{gutter:20},{default:t(()=>[e(s,{span:12},{default:t(()=>[e(r,{modelValue:B.value,"onUpdate:modelValue":l[6]||(l[6]=a=>B.value=a),modelModifiers:{trim:!0},placeholder:"最小值",type:"number",min:"0.000001"},null,8,["modelValue"])]),_:1}),e(s,{span:12},{default:t(()=>[e(r,{modelValue:H.value,"onUpdate:modelValue":l[7]||(l[7]=a=>H.value=a),modelModifiers:{trim:!0},placeholder:"宽度",type:"number"},null,8,["modelValue"])]),_:1})]),_:1}),_e]),_:1}),e(p,{label:"最大样本数",prop:"maxSamples"},{default:t(()=>[e(s,{span:5.5},{default:t(()=>[e(r,{modelValue:L.value,"onUpdate:modelValue":l[8]||(l[8]=a=>L.value=a),modelModifiers:{trim:!0},placeholder:"最大样本数",type:"number",min:"1"},null,8,["modelValue"])]),_:1},8,["span"]),ye]),_:1}),e(p,{label:"交叉概率",prop:"pCrossover"},{default:t(()=>[e(b,{gutter:20},{default:t(()=>[e(s,{span:12},{default:t(()=>[e(r,{modelValue:N.value,"onUpdate:modelValue":l[9]||(l[9]=a=>N.value=a),modelModifiers:{trim:!0},placeholder:"最小值",type:"number",min:"0.3",max:"0.5"},null,8,["modelValue"])]),_:1}),e(s,{span:12},{default:t(()=>[e(r,{modelValue:j.value,"onUpdate:modelValue":l[10]||(l[10]=a=>j.value=a),modelModifiers:{trim:!0},placeholder:"宽度",type:"number",min:"0.3",max:"0.5"},null,8,["modelValue"])]),_:1})]),_:1}),be]),_:1}),e(p,{label:"子树变异概率",prop:"pSubtreeMutation"},{default:t(()=>[e(b,{gutter:20},{default:t(()=>[e(s,{span:12},{default:t(()=>[e(r,{modelValue:O.value,"onUpdate:modelValue":l[11]||(l[11]=a=>O.value=a),modelModifiers:{trim:!0},placeholder:"最小值",type:"number",min:"0.1",max:"0.25"},null,8,["modelValue"])]),_:1}),e(s,{span:12},{default:t(()=>[e(r,{modelValue:T.value,"onUpdate:modelValue":l[12]||(l[12]=a=>T.value=a),modelModifiers:{trim:!0},placeholder:"宽度",type:"number",min:"0.1",max:"0.25"},null,8,["modelValue"])]),_:1})]),_:1}),he]),_:1}),e(p,{label:"提升变异",prop:"pHoistMutation"},{default:t(()=>[e(b,{gutter:20},{default:t(()=>[e(s,{span:12},{default:t(()=>[e(r,{modelValue:P.value,"onUpdate:modelValue":l[13]||(l[13]=a=>P.value=a),modelModifiers:{trim:!0},placeholder:"最小值",type:"number",min:"0.05",max:"0.15"},null,8,["modelValue"])]),_:1}),e(s,{span:12},{default:t(()=>[e(r,{modelValue:R.value,"onUpdate:modelValue":l[14]||(l[14]=a=>R.value=a),modelModifiers:{trim:!0},placeholder:"宽度",type:"number",min:"0.05",max:"0.15"},null,8,["modelValue"])]),_:1})]),_:1}),Ve]),_:1}),e(p,{label:"点变异",prop:"pPointMutation"},{default:t(()=>[e(b,{gutter:20},{default:t(()=>[e(s,{span:12},{default:t(()=>[e(r,{modelValue:D.value,"onUpdate:modelValue":l[15]||(l[15]=a=>D.value=a),modelModifiers:{trim:!0},placeholder:"最小值",type:"number",min:"0.05",max:"0.15"},null,8,["modelValue"])]),_:1}),e(s,{span:12},{default:t(()=>[e(r,{modelValue:F.value,"onUpdate:modelValue":l[16]||(l[16]=a=>F.value=a),modelModifiers:{trim:!0},placeholder:"宽度",type:"number",min:"0.05",max:"0.15"},null,8,["modelValue"])]),_:1})]),_:1}),xe]),_:1}),e(p,null,{default:t(()=>[e(h,{type:"primary",onClick:le},{default:t(()=>[y("下一步")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})):k("",!0),f.value===1?(d(),x(re,{key:1,drag:"",action:Q,"on-success":oe,"before-upload":te,"auto-upload":!0,limit:1,"on-error":ue},{default:t(()=>[e(h,{slot:"trigger",type:"primary"},{default:t(()=>[y("选择文件")]),_:1}),ge,y(" (最多上传一个文件) ")]),_:1})):k("",!0),f.value===2?(d(),x(X,{key:2},{default:t(()=>[Me,Object.keys(v.value).length>0?(d(),x(q,{key:0,"label-width":"200"},{default:t(()=>[e(b,{justify:"center"},{default:t(()=>[(d(!0),w(I,null,K(v.value,(a,M)=>(d(),x(s,{key:M},{default:t(()=>[e(p,{label:M},{default:t(()=>[e(r,{modelValue:v.value[M],"onUpdate:modelValue":se=>v.value[M]=se,modelModifiers:{trim:!0},readonly:!0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1})]),_:1})):k("",!0),e(h,{onClick:J,type:"primary"},{default:t(()=>[y("返回上一步")]),_:1}),e(h,{onClick:ae,type:"primary",loading:U.value},{default:t(()=>[y("下载结果")]),_:1},8,["loading"]),e(h,{type:"primary",size:"default",onClick:Y},{default:t(()=>[y("下载转换前的特征")]),_:1}),e(h,{type:"primary",size:"default",onClick:Z},{default:t(()=>[y("下载转换后的特征")]),_:1})]),_:1})):k("",!0),f.value===3?(d(),x(X,{key:3},{default:t(()=>[we,G.value.length>0?(d(),w("div",ke,[i("ul",null,[(d(!0),w(I,null,K(G.value,(a,M)=>(d(),w("li",{key:M},ce(a),1))),128))])])):(d(),w("div",Se,Ce))]),_:1})):k("",!0),f.value===1?(d(),x(h,{key:4,disabled:!(V.value.length>0),onClick:ne,type:"primary",loading:S.value},{default:t(()=>[y("提交")]),_:1},8,["disabled","loading"])):k("",!0),ie(e(h,{onClick:J,slot:"tip"},{default:t(()=>[y("返回")]),_:1},512),[[pe,f.value===1]])])}}});export{Ee as default};
