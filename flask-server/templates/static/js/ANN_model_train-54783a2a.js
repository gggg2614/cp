const H=Vue.defineComponent({__name:"ANN_model_train",setup(O){const n=Vue.ref(0),a=Vue.ref({cycles:"",epoch:"",feature_add_num:""}),V=Vue.ref([]),p=Vue.ref([]),m=Vue.ref(!1),b=Vue.ref(!1),f=Vue.ref([]),h=Vue.ref([]),w=Vue.ref(!1),y=Vue.ref(!1),C=t=>e=>{const l=e.target.value;a.value[t]=l.replace(/\D/g,"")},N=async()=>{if(f.value.length===0||h.value.length===0){ElementPlus.ElMessage.error("请上传文件");return}w.value=!0;const t=new FormData;t.append("model",f.value[0]),t.append("data_pre",h.value[0]);try{const e=await fetch("http://localhost:5000/predict",{method:"POST",body:t});return y.value=!0,e}catch{ElementPlus.ElMessage.error("发生错误")}finally{w.value=!1}},g=()=>{const t=parseInt(a.value.feature_add_num);if(isNaN(t)||t<0||t>10){ElementPlus.ElMessage.error("Feature Add Num must be a number between 0 and 10");return}if(V.value.length===0||p.value.length===0){ElementPlus.ElMessage.error("请上传文件");return}D()},P=()=>{n.value++},T=(t,e,l)=>{f.value.push(e.raw),ElementPlus.ElMessage.success("pth file uploaded successfully")},k=(t,e,l)=>{h.value.push(e.raw),ElementPlus.ElMessage.success("model file uploaded successfully")},M=(t,e,l)=>{V.value.push(e.raw),ElementPlus.ElMessage.success("Data file uploaded successfully")},U=(t,e,l)=>{p.value.push(e.raw),ElementPlus.ElMessage.success("Data2 file uploaded successfully")},D=async()=>{if(!x)return;m.value=!0;const t=new FormData;t.append("cycles",a.value.cycles),t.append("epoch",a.value.epoch),t.append("feature_add_num",a.value.feature_add_num),t.append("data",V.value[0]),t.append("data2",p.value[0]);try{(await await fetch("http://localhost:5000/train",{method:"POST",body:t})).status==200?(ElementPlus.ElMessage.success("Model trained successfully"),b.value=!0):ElementPlus.ElMessage.error("训练失败，请检查文件是否有误")}catch(e){console.error("Error:",e),ElementPlus.ElMessage.error("训练失败，请检查文件是否有误")}finally{m.value=!1}},d=(t,e)=>{if(t.name.split(".")[1]!==e)return ElementPlus.ElMessage.error(`请上传.${e}文件`),!1},F=async()=>{try{const e=await(await fetch("http://localhost:5000/download_results",{method:"GET"})).blob(),l=window.URL.createObjectURL(e),o=document.createElement("a");o.href=l,o.setAttribute("download","results.csv"),document.body.appendChild(o),o.click(),ElementPlus.ElMessage.success("Results CSV downloaded successfully")}catch(t){console.error("Error:",t),ElementPlus.ElMessage.error("Failed to download results CSV")}},j=async()=>{try{const e=await(await fetch("http://localhost:5000/download_model",{method:"GET"})).blob(),l=window.URL.createObjectURL(e),o=document.createElement("a");o.href=l,o.setAttribute("download","best_model.pth"),document.body.appendChild(o),o.click(),ElementPlus.ElMessage.success("Model PTH downloaded successfully")}catch(t){console.error("Error:",t),ElementPlus.ElMessage.error("Failed to download model PTH")}},L=async()=>{try{const e=await(await fetch("http://localhost:5000/download_joblibX",{method:"GET"})).blob(),l=window.URL.createObjectURL(e),o=document.createElement("a");o.href=l,o.setAttribute("download","X_scaler.joblib"),document.body.appendChild(o),o.click(),ElementPlus.ElMessage.success("Model PTH downloaded successfully")}catch(t){console.error("Error:",t),ElementPlus.ElMessage.error("Failed to download model PTH")}},R=async()=>{try{const e=await(await fetch("http://localhost:5000/download_joblibY",{method:"GET"})).blob(),l=window.URL.createObjectURL(e),o=document.createElement("a");o.href=l,o.setAttribute("download","Y_scaler.joblib"),document.body.appendChild(o),o.click(),ElementPlus.ElMessage.success("Model PTH downloaded successfully")}catch(t){console.error("Error:",t),ElementPlus.ElMessage.error("Failed to download model PTH")}},A=async()=>{try{const e=await(await fetch("http://localhost:5000/download_predict_file",{method:"GET"})).blob(),l=window.URL.createObjectURL(e),o=document.createElement("a");o.href=l,o.setAttribute("download","predicted_output_file.xlsx"),document.body.appendChild(o),o.click(),ElementPlus.ElMessage.success("predicted file downloaded successfully")}catch(t){console.error("Error:",t),ElementPlus.ElMessage.error("Failed to download model file")}},x=Vue.computed(()=>a.value.cycles&&a.value.epoch&&a.value.feature_add_num),c=(t,e,l)=>{ElementPlus.ElMessage.error("上传文件发生错误，请检查文件是否正确")};return(t,e)=>{const l=Vue.resolveComponent("el-step"),o=Vue.resolveComponent("el-steps"),_=Vue.resolveComponent("el-input"),s=Vue.resolveComponent("el-form-item"),r=Vue.resolveComponent("el-button"),i=Vue.resolveComponent("el-upload"),B=Vue.resolveComponent("el-form"),E=Vue.resolveComponent("el-main"),v=Vue.resolveComponent("el-container");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createVNode(o,{active:n.value,"finish-status":"success","align-center":"",style:{"margin-bottom":"20px"}},{default:Vue.withCtx(()=>[Vue.createVNode(l,{title:"第一步"}),Vue.createVNode(l,{title:"第二步"})]),_:1},8,["active"]),n.value===0?(Vue.openBlock(),Vue.createBlock(v,{key:0},{default:Vue.withCtx(()=>[Vue.createVNode(E,null,{default:Vue.withCtx(()=>[Vue.createVNode(B,{ref:"form",model:a.value,"label-width":"120px"},{default:Vue.withCtx(()=>[Vue.createVNode(s,{label:"Cycles"},{default:Vue.withCtx(()=>[Vue.createVNode(_,{onInput:e[0]||(e[0]=u=>C("cycles")),modelValue:a.value.cycles,"onUpdate:modelValue":e[1]||(e[1]=u=>a.value.cycles=u),modelModifiers:{trim:!0},placeholder:"请输入整数",min:"0",type:"number",step:"1"},null,8,["modelValue"])]),_:1}),Vue.createVNode(s,{label:"Epoch"},{default:Vue.withCtx(()=>[Vue.createVNode(_,{modelValue:a.value.epoch,"onUpdate:modelValue":e[2]||(e[2]=u=>a.value.epoch=u),modelModifiers:{trim:!0},placeholder:"请输入整数",min:"0",type:"number"},null,8,["modelValue"])]),_:1}),Vue.createVNode(s,{label:"FeatureAddNum"},{default:Vue.withCtx(()=>[Vue.createVNode(_,{modelValue:a.value.feature_add_num,"onUpdate:modelValue":e[3]||(e[3]=u=>a.value.feature_add_num=u),modelModifiers:{trim:!0},placeholder:"请输入0-10的数",type:"number",min:"0",max:"10"},null,8,["modelValue"])]),_:1}),Vue.createVNode(s,{label:"Data File(.xlsx)"},{default:Vue.withCtx(()=>[Vue.createVNode(i,{action:"http://localhost:5000/upload","on-success":M,"before-upload":u=>d(u,"xlsx"),limit:1,"on-error":c},{default:Vue.withCtx(()=>[Vue.createVNode(r,{slot:" trigger",type:"primary"},{default:Vue.withCtx(()=>[Vue.createTextVNode("Upload")]),_:1}),Vue.createTextVNode("(最多上传一个文件) ")]),_:1},8,["before-upload"])]),_:1}),Vue.createVNode(s,{label:"Data2 File(.csv)"},{default:Vue.withCtx(()=>[Vue.createVNode(i,{"on-success":U,action:"http://localhost:5000/upload","before-upload":u=>d(u,"csv"),limit:1,"on-error":c},{default:Vue.withCtx(()=>[Vue.createVNode(r,{slot:"trigger",type:"primary"},{default:Vue.withCtx(()=>[Vue.createTextVNode("Upload")]),_:1}),Vue.createTextVNode("(最多上传一个文件) ")]),_:1},8,["before-upload"])]),_:1}),Vue.createVNode(s,null,{default:Vue.withCtx(()=>[Vue.createVNode(r,{type:"primary",onClick:g,loading:m.value,disabled:!Vue.unref(x)},{default:Vue.withCtx(()=>[Vue.createTextVNode("Train Model")]),_:1},8,["loading","disabled"])]),_:1}),b.value?(Vue.openBlock(),Vue.createBlock(s,{key:0},{default:Vue.withCtx(()=>[Vue.createVNode(r,{type:"success",onClick:F},{default:Vue.withCtx(()=>[Vue.createTextVNode("Download CSV")]),_:1}),Vue.createVNode(r,{type:"success",onClick:j},{default:Vue.withCtx(()=>[Vue.createTextVNode("Download PTH")]),_:1}),Vue.createVNode(r,{type:"success",onClick:L},{default:Vue.withCtx(()=>[Vue.createTextVNode("Download joblibX")]),_:1}),Vue.createVNode(r,{type:"success",onClick:R},{default:Vue.withCtx(()=>[Vue.createTextVNode("Download joblibY")]),_:1}),Vue.createVNode(r,{type:"primary",onClick:P},{default:Vue.withCtx(()=>[Vue.createTextVNode("下一步")]),_:1})]),_:1})):Vue.createCommentVNode("",!0)]),_:1},8,["model"])]),_:1})]),_:1})):n.value===1?(Vue.openBlock(),Vue.createBlock(v,{key:1},{default:Vue.withCtx(()=>[Vue.createVNode(E,null,{default:Vue.withCtx(()=>[Vue.createElementVNode("div",null,[Vue.createVNode(i,{action:"http://localhost:5000/upload","on-success":T,"auto-upload":!0,"before-upload":u=>d(u,"pth"),limit:1,"on-error":c},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 模型文件(.pth)："),Vue.createVNode(r,{type:"primary"},{default:Vue.withCtx(()=>[Vue.createTextVNode("上传模型文件")]),_:1}),Vue.createTextVNode("(最多上传一个文件) ")]),_:1},8,["before-upload"]),Vue.createVNode(i,{action:"http://localhost:5000/upload","on-success":k,limit:1,"auto-upload":!0,"before-upload":u=>d(u,"xlsx"),"on-error":c},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 数据文件(.xlsx)："),Vue.createVNode(r,{type:"primary"},{default:Vue.withCtx(()=>[Vue.createTextVNode("上传数据文件")]),_:1}),Vue.createTextVNode("(最多上传一个文件) ")]),_:1},8,["before-upload"]),Vue.createVNode(r,{onClick:N,loading:w.value,type:"primary"},{default:Vue.withCtx(()=>[Vue.createTextVNode("预测")]),_:1},8,["loading"]),y.value?(Vue.openBlock(),Vue.createBlock(r,{key:0,type:"success",onClick:A},{default:Vue.withCtx(()=>[Vue.createTextVNode("下载预测结果")]),_:1})):Vue.createCommentVNode("",!0),Vue.createVNode(r,{type:"primary",onClick:e[4]||(e[4]=u=>n.value--)},{default:Vue.withCtx(()=>[Vue.createTextVNode("返回上一步")]),_:1})])]),_:1})]),_:1})):Vue.createCommentVNode("",!0)])}}});export{H as default};
